import{O as Mn,V as vt,a as k,M as wn,Q as gt,P as mt,S as lt,C as On,D as st,b as Rn,c as yt,d as wt,A as St,e as xt,f as Et,W as Mt,g as Ct,h as Pt,E as _t,i as zt,B as Wt,L as Nn,j as Dn,G as Bn,k as Lt}from"./OrbitControls-a766af40.js";import{e as J}from"./tween.module-b80cf431.js";import{e as Ot,o as Rt,c as It}from"./index-df2c5228.js";class Hn extends Mn{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new vt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(t,i){return super.copy(t,i),this.element=t.element.cloneNode(!0),this.center=t.center,this}}const j=new k,Fn=new wn,$n=new wn,Gn=new k,Un=new k;class At{constructor(t={}){const i=this;let e,o,p,h;const d={objects:new WeakMap},S=t.element!==void 0?t.element:document.createElement("div");S.style.overflow="hidden",this.domElement=S,this.getSize=function(){return{width:e,height:o}},this.render=function(u,f){u.matrixWorldAutoUpdate===!0&&u.updateMatrixWorld(),f.parent===null&&f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),Fn.copy(f.matrixWorldInverse),$n.multiplyMatrices(f.projectionMatrix,Fn),g(u,u,f),s(u)},this.setSize=function(u,f){e=u,o=f,p=e/2,h=o/2,S.style.width=u+"px",S.style.height=f+"px"};function g(u,f,c){if(u.isCSS2DObject){j.setFromMatrixPosition(u.matrixWorld),j.applyMatrix4($n);const r=u.visible===!0&&j.z>=-1&&j.z<=1&&u.layers.test(c.layers)===!0;if(u.element.style.display=r===!0?"":"none",r===!0){u.onBeforeRender(i,f,c);const y=u.element;y.style.transform="translate("+-100*u.center.x+"%,"+-100*u.center.y+"%)translate("+(j.x*p+p)+"px,"+(-j.y*h+h)+"px)",y.parentNode!==S&&S.appendChild(y),u.onAfterRender(i,f,c)}const x={distanceToCameraSquared:a(c,u)};d.objects.set(u,x)}for(let r=0,x=u.children.length;r<x;r++)g(u.children[r],f,c)}function a(u,f){return Gn.setFromMatrixPosition(u.matrixWorld),Un.setFromMatrixPosition(f.matrixWorld),Gn.distanceToSquared(Un)}function l(u){const f=[];return u.traverse(function(c){c.isCSS2DObject&&f.push(c)}),f}function s(u){const f=l(u).sort(function(r,x){if(r.renderOrder!==x.renderOrder)return x.renderOrder-r.renderOrder;const y=d.objects.get(r).distanceToCameraSquared,w=d.objects.get(x).distanceToCameraSquared;return y-w}),c=f.length;for(let r=0,x=f.length;r<x;r++)f[r].element.style.zIndex=c-r}}}const qn=new k,Tt=new gt,Xn=new k,Y=new wn,Nt=new wn;class Dt{constructor(t={}){const i=this;let e,o,p,h;const d={camera:{fov:0,style:""},objects:new WeakMap},S=t.element!==void 0?t.element:document.createElement("div");S.style.overflow="hidden",this.domElement=S;const g=document.createElement("div");g.style.transformOrigin="0 0",g.style.pointerEvents="none",S.appendChild(g);const a=document.createElement("div");a.style.transformStyle="preserve-3d",g.appendChild(a),this.getSize=function(){return{width:e,height:o}},this.render=function(c,r){const x=r.projectionMatrix.elements[5]*h;d.camera.fov!==x&&(g.style.perspective=r.isPerspectiveCamera?x+"px":"",d.camera.fov=x),r.view&&r.view.enabled?(g.style.transform=`translate( ${-r.view.offsetX*(e/r.view.width)}px, ${-r.view.offsetY*(o/r.view.height)}px )`,g.style.transform+=`scale( ${r.view.fullWidth/r.view.width}, ${r.view.fullHeight/r.view.height} )`):g.style.transform="",c.matrixWorldAutoUpdate===!0&&c.updateMatrixWorld(),r.parent===null&&r.matrixWorldAutoUpdate===!0&&r.updateMatrixWorld();let y,w;r.isOrthographicCamera&&(y=-(r.right+r.left)/2,w=(r.top+r.bottom)/2);const m=r.view&&r.view.enabled?r.view.height/r.view.fullHeight:1,M=(r.isOrthographicCamera?`scale( ${m} )scale(`+x+")translate("+l(y)+"px,"+l(w)+"px)"+s(r.matrixWorldInverse):`scale( ${m} )translateZ(`+x+"px)"+s(r.matrixWorldInverse))+"translate("+p+"px,"+h+"px)";d.camera.style!==M&&(a.style.transform=M,d.camera.style=M),f(c,c,r)},this.setSize=function(c,r){e=c,o=r,p=e/2,h=o/2,S.style.width=c+"px",S.style.height=r+"px",g.style.width=c+"px",g.style.height=r+"px",a.style.width=c+"px",a.style.height=r+"px"};function l(c){return Math.abs(c)<1e-10?0:c}function s(c){const r=c.elements;return"matrix3d("+l(r[0])+","+l(-r[1])+","+l(r[2])+","+l(r[3])+","+l(r[4])+","+l(-r[5])+","+l(r[6])+","+l(r[7])+","+l(r[8])+","+l(-r[9])+","+l(r[10])+","+l(r[11])+","+l(r[12])+","+l(-r[13])+","+l(r[14])+","+l(r[15])+")"}function u(c){const r=c.elements;return"translate(-50%,-50%)"+("matrix3d("+l(r[0])+","+l(r[1])+","+l(r[2])+","+l(r[3])+","+l(-r[4])+","+l(-r[5])+","+l(-r[6])+","+l(-r[7])+","+l(r[8])+","+l(r[9])+","+l(r[10])+","+l(r[11])+","+l(r[12])+","+l(r[13])+","+l(r[14])+","+l(r[15])+")")}function f(c,r,x,y){if(c.isCSS3DObject){const w=c.visible===!0&&c.layers.test(x.layers)===!0;if(c.element.style.display=w===!0?"":"none",w===!0){c.onBeforeRender(i,r,x);let m;c.isCSS3DSprite?(Y.copy(x.matrixWorldInverse),Y.transpose(),c.rotation2D!==0&&Y.multiply(Nt.makeRotationZ(c.rotation2D)),c.matrixWorld.decompose(qn,Tt,Xn),Y.setPosition(qn),Y.scale(Xn),Y.elements[3]=0,Y.elements[7]=0,Y.elements[11]=0,Y.elements[15]=1,m=u(Y)):m=u(c.matrixWorld);const E=c.element,M=d.objects.get(c);if(M===void 0||M.style!==m){E.style.transform=m;const _={style:m};d.objects.set(c,_)}E.parentNode!==a&&a.appendChild(E),c.onAfterRender(i,r,x)}}for(let w=0,m=c.children.length;w<m;w++)f(c.children[w],r,x)}}}class Bt{constructor(){this._partials=new Float64Array(32),this._n=0}add(t){const i=this._partials;let e=0;for(let o=0;o<this._n&&o<32;o++){const p=i[o],h=t+p,d=Math.abs(t)<Math.abs(p)?t-(h-p):p-(h-t);d&&(i[e++]=d),t=h}return i[e]=t,this._n=e+1,this}valueOf(){const t=this._partials;let i=this._n,e,o,p,h=0;if(i>0){for(h=t[--i];i>0&&(e=h,o=t[--i],h=e+o,p=o-(h-e),!p););i>0&&(p<0&&t[i-1]<0||p>0&&t[i-1]>0)&&(o=p*2,e=h+o,o==e-h&&(h=e))}return h}}function*Ht(n){for(const t of n)yield*t}function at(n){return Array.from(Ht(n))}var I=1e-6,Ft=1e-12,L=Math.PI,G=L/2,Yn=L/4,X=L*2,U=180/L,B=L/180,T=Math.abs,ut=Math.atan,ln=Math.atan2,N=Math.cos,$t=Math.exp,Gt=Math.log,D=Math.sin,Ut=Math.sign||function(n){return n>0?1:n<0?-1:0},Sn=Math.sqrt,qt=Math.tan;function Xt(n){return n>1?0:n<-1?L:Math.acos(n)}function sn(n){return n>1?G:n<-1?-G:Math.asin(n)}function en(){}function vn(n,t){n&&Qn.hasOwnProperty(n.type)&&Qn[n.type](n,t)}var Vn={Feature:function(n,t){vn(n.geometry,t)},FeatureCollection:function(n,t){for(var i=n.features,e=-1,o=i.length;++e<o;)vn(i[e].geometry,t)}},Qn={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var i=n.coordinates,e=-1,o=i.length;++e<o;)n=i[e],t.point(n[0],n[1],n[2])},LineString:function(n,t){Cn(n.coordinates,t,0)},MultiLineString:function(n,t){for(var i=n.coordinates,e=-1,o=i.length;++e<o;)Cn(i[e],t,0)},Polygon:function(n,t){kn(n.coordinates,t)},MultiPolygon:function(n,t){for(var i=n.coordinates,e=-1,o=i.length;++e<o;)kn(i[e],t)},GeometryCollection:function(n,t){for(var i=n.geometries,e=-1,o=i.length;++e<o;)vn(i[e],t)}};function Cn(n,t,i){var e=-1,o=n.length-i,p;for(t.lineStart();++e<o;)p=n[e],t.point(p[0],p[1],p[2]);t.lineEnd()}function kn(n,t){var i=-1,e=n.length;for(t.polygonStart();++i<e;)Cn(n[i],t,1);t.polygonEnd()}function Yt(n,t){n&&Vn.hasOwnProperty(n.type)?Vn[n.type](n,t):vn(n,t)}function Pn(n){return[ln(n[1],n[0]),sn(n[2])]}function b(n){var t=n[0],i=n[1],e=N(i);return[e*N(t),e*D(t),D(i)]}function fn(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function gn(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function xn(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function cn(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function _n(n){var t=Sn(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function zn(n,t){function i(e,o){return e=n(e,o),t(e[0],e[1])}return n.invert&&t.invert&&(i.invert=function(e,o){return e=t.invert(e,o),e&&n.invert(e[0],e[1])}),i}function Wn(n,t){return T(n)>L&&(n-=Math.round(n/X)*X),[n,t]}Wn.invert=Wn;function ft(n,t,i){return(n%=X)?t||i?zn(Jn(n),Kn(t,i)):Jn(n):t||i?Kn(t,i):Wn}function Zn(n){return function(t,i){return t+=n,T(t)>L&&(t-=Math.round(t/X)*X),[t,i]}}function Jn(n){var t=Zn(n);return t.invert=Zn(-n),t}function Kn(n,t){var i=N(n),e=D(n),o=N(t),p=D(t);function h(d,S){var g=N(S),a=N(d)*g,l=D(d)*g,s=D(S),u=s*i+a*e;return[ln(l*o-u*p,a*i-s*e),sn(u*o+l*p)]}return h.invert=function(d,S){var g=N(S),a=N(d)*g,l=D(d)*g,s=D(S),u=s*o-l*p;return[ln(l*o+s*p,a*i+u*e),sn(u*i-a*e)]},h}function Vt(n){n=ft(n[0]*B,n[1]*B,n.length>2?n[2]*B:0);function t(i){return i=n(i[0]*B,i[1]*B),i[0]*=U,i[1]*=U,i}return t.invert=function(i){return i=n.invert(i[0]*B,i[1]*B),i[0]*=U,i[1]*=U,i},t}function Qt(n,t,i,e,o,p){if(i){var h=N(t),d=D(t),S=e*i;o==null?(o=t+e*X,p=t-S/2):(o=jn(h,o),p=jn(h,p),(e>0?o<p:o>p)&&(o+=e*X));for(var g,a=o;e>0?a>p:a<p;a-=S)g=Pn([h,-d*N(a),-d*D(a)]),n.point(g[0],g[1])}}function jn(n,t){t=b(t),t[0]-=n,_n(t);var i=Xt(-t[1]);return((-t[2]<0?-i:i)+X-I)%X}function ct(){var n=[],t;return{point:function(i,e,o){t.push([i,e,o])},lineStart:function(){n.push(t=[])},lineEnd:en,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var i=n;return n=[],t=null,i}}}function dn(n,t){return T(n[0]-t[0])<I&&T(n[1]-t[1])<I}function pn(n,t,i,e){this.x=n,this.z=t,this.o=i,this.e=e,this.v=!1,this.n=this.p=null}function pt(n,t,i,e,o){var p=[],h=[],d,S;if(n.forEach(function(f){if(!((c=f.length-1)<=0)){var c,r=f[0],x=f[c],y;if(dn(r,x)){if(!r[2]&&!x[2]){for(o.lineStart(),d=0;d<c;++d)o.point((r=f[d])[0],r[1]);o.lineEnd();return}x[0]+=2*I}p.push(y=new pn(r,f,null,!0)),h.push(y.o=new pn(r,null,y,!1)),p.push(y=new pn(x,f,null,!1)),h.push(y.o=new pn(x,null,y,!0))}}),!!p.length){for(h.sort(t),bn(p),bn(h),d=0,S=h.length;d<S;++d)h[d].e=i=!i;for(var g=p[0],a,l;;){for(var s=g,u=!0;s.v;)if((s=s.n)===g)return;a=s.z,o.lineStart();do{if(s.v=s.o.v=!0,s.e){if(u)for(d=0,S=a.length;d<S;++d)o.point((l=a[d])[0],l[1]);else e(s.x,s.n.x,1,o);s=s.n}else{if(u)for(a=s.p.z,d=a.length-1;d>=0;--d)o.point((l=a[d])[0],l[1]);else e(s.x,s.p.x,-1,o);s=s.p}s=s.o,a=s.z,u=!u}while(!s.v);o.lineEnd()}}}function bn(n){if(t=n.length){for(var t,i=0,e=n[0],o;++i<t;)e.n=o=n[i],o.p=e,e=o;e.n=o=n[0],o.p=e}}function En(n){return T(n[0])<=L?n[0]:Ut(n[0])*((T(n[0])+L)%X-L)}function kt(n,t){var i=En(t),e=t[1],o=D(e),p=[D(i),-N(i),0],h=0,d=0,S=new Bt;o===1?e=G+I:o===-1&&(e=-G-I);for(var g=0,a=n.length;g<a;++g)if(s=(l=n[g]).length)for(var l,s,u=l[s-1],f=En(u),c=u[1]/2+Yn,r=D(c),x=N(c),y=0;y<s;++y,f=m,r=M,x=_,u=w){var w=l[y],m=En(w),E=w[1]/2+Yn,M=D(E),_=N(E),z=m-f,P=z>=0?1:-1,O=P*z,C=O>L,F=r*M;if(S.add(ln(F*P*D(O),x*_+F*N(O))),h+=C?z+P*X:z,C^f>=i^m>=i){var A=gn(b(u),b(w));_n(A);var R=gn(p,A);_n(R);var v=(C^z>=0?-1:1)*sn(R[2]);(e>v||e===v&&(A[0]||A[1]))&&(d+=C^z>=0?1:-1)}}return(h<-I||h<I&&S<-Ft)^d&1}function ht(n,t,i,e){return function(o){var p=t(o),h=ct(),d=t(h),S=!1,g,a,l,s={point:u,lineStart:c,lineEnd:r,polygonStart:function(){s.point=x,s.lineStart=y,s.lineEnd=w,a=[],g=[]},polygonEnd:function(){s.point=u,s.lineStart=c,s.lineEnd=r,a=at(a);var m=kt(g,e);a.length?(S||(o.polygonStart(),S=!0),pt(a,Jt,m,i,o)):m&&(S||(o.polygonStart(),S=!0),o.lineStart(),i(null,null,1,o),o.lineEnd()),S&&(o.polygonEnd(),S=!1),a=g=null},sphere:function(){o.polygonStart(),o.lineStart(),i(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function u(m,E){n(m,E)&&o.point(m,E)}function f(m,E){p.point(m,E)}function c(){s.point=f,p.lineStart()}function r(){s.point=u,p.lineEnd()}function x(m,E){l.push([m,E]),d.point(m,E)}function y(){d.lineStart(),l=[]}function w(){x(l[0][0],l[0][1]),d.lineEnd();var m=d.clean(),E=h.result(),M,_=E.length,z,P,O;if(l.pop(),g.push(l),l=null,!!_){if(m&1){if(P=E[0],(z=P.length-1)>0){for(S||(o.polygonStart(),S=!0),o.lineStart(),M=0;M<z;++M)o.point((O=P[M])[0],O[1]);o.lineEnd()}return}_>1&&m&2&&E.push(E.pop().concat(E.shift())),a.push(E.filter(Zt))}}return s}}function Zt(n){return n.length>1}function Jt(n,t){return((n=n.x)[0]<0?n[1]-G-I:G-n[1])-((t=t.x)[0]<0?t[1]-G-I:G-t[1])}const nt=ht(function(){return!0},Kt,bt,[-L,-G]);function Kt(n){var t=NaN,i=NaN,e=NaN,o;return{lineStart:function(){n.lineStart(),o=1},point:function(p,h){var d=p>0?L:-L,S=T(p-t);T(S-L)<I?(n.point(t,i=(i+h)/2>0?G:-G),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(d,i),n.point(p,i),o=0):e!==d&&S>=L&&(T(t-e)<I&&(t-=e*I),T(p-d)<I&&(p-=d*I),i=jt(t,i,p,h),n.point(e,i),n.lineEnd(),n.lineStart(),n.point(d,i),o=0),n.point(t=p,i=h),e=d},lineEnd:function(){n.lineEnd(),t=i=NaN},clean:function(){return 2-o}}}function jt(n,t,i,e){var o,p,h=D(n-i);return T(h)>I?ut((D(t)*(p=N(e))*D(i)-D(e)*(o=N(t))*D(n))/(o*p*h)):(t+e)/2}function bt(n,t,i,e){var o;if(n==null)o=i*G,e.point(-L,o),e.point(0,o),e.point(L,o),e.point(L,0),e.point(L,-o),e.point(0,-o),e.point(-L,-o),e.point(-L,0),e.point(-L,o);else if(T(n[0]-t[0])>I){var p=n[0]<t[0]?L:-L;o=i*p/2,e.point(-p,o),e.point(0,o),e.point(p,o)}else e.point(t[0],t[1])}function ne(n){var t=N(n),i=6*B,e=t>0,o=T(t)>I;function p(a,l,s,u){Qt(u,n,i,s,a,l)}function h(a,l){return N(a)*N(l)>t}function d(a){var l,s,u,f,c;return{lineStart:function(){f=u=!1,c=1},point:function(r,x){var y=[r,x],w,m=h(r,x),E=e?m?0:g(r,x):m?g(r+(r<0?L:-L),x):0;if(!l&&(f=u=m)&&a.lineStart(),m!==u&&(w=S(l,y),(!w||dn(l,w)||dn(y,w))&&(y[2]=1)),m!==u)c=0,m?(a.lineStart(),w=S(y,l),a.point(w[0],w[1])):(w=S(l,y),a.point(w[0],w[1],2),a.lineEnd()),l=w;else if(o&&l&&e^m){var M;!(E&s)&&(M=S(y,l,!0))&&(c=0,e?(a.lineStart(),a.point(M[0][0],M[0][1]),a.point(M[1][0],M[1][1]),a.lineEnd()):(a.point(M[1][0],M[1][1]),a.lineEnd(),a.lineStart(),a.point(M[0][0],M[0][1],3)))}m&&(!l||!dn(l,y))&&a.point(y[0],y[1]),l=y,u=m,s=E},lineEnd:function(){u&&a.lineEnd(),l=null},clean:function(){return c|(f&&u)<<1}}}function S(a,l,s){var u=b(a),f=b(l),c=[1,0,0],r=gn(u,f),x=fn(r,r),y=r[0],w=x-y*y;if(!w)return!s&&a;var m=t*x/w,E=-t*y/w,M=gn(c,r),_=cn(c,m),z=cn(r,E);xn(_,z);var P=M,O=fn(_,P),C=fn(P,P),F=O*O-C*(fn(_,_)-1);if(!(F<0)){var A=Sn(F),R=cn(P,(-O-A)/C);if(xn(R,_),R=Pn(R),!s)return R;var v=a[0],W=l[0],H=a[1],$=l[1],q;W<v&&(q=v,v=W,W=q);var tn=W-v,V=T(tn-L)<I,Z=V||tn<I;if(!V&&$<H&&(q=H,H=$,$=q),Z?V?H+$>0^R[1]<(T(R[0]-v)<I?H:$):H<=R[1]&&R[1]<=$:tn>L^(v<=R[0]&&R[0]<=W)){var Q=cn(P,(-O+A)/C);return xn(Q,_),[R,Pn(Q)]}}}function g(a,l){var s=e?n:L-n,u=0;return a<-s?u|=1:a>s&&(u|=2),l<-s?u|=4:l>s&&(u|=8),u}return ht(h,d,p,e?[0,-n]:[-L,n-L])}function te(n,t,i,e,o,p){var h=n[0],d=n[1],S=t[0],g=t[1],a=0,l=1,s=S-h,u=g-d,f;if(f=i-h,!(!s&&f>0)){if(f/=s,s<0){if(f<a)return;f<l&&(l=f)}else if(s>0){if(f>l)return;f>a&&(a=f)}if(f=o-h,!(!s&&f<0)){if(f/=s,s<0){if(f>l)return;f>a&&(a=f)}else if(s>0){if(f<a)return;f<l&&(l=f)}if(f=e-d,!(!u&&f>0)){if(f/=u,u<0){if(f<a)return;f<l&&(l=f)}else if(u>0){if(f>l)return;f>a&&(a=f)}if(f=p-d,!(!u&&f<0)){if(f/=u,u<0){if(f>l)return;f>a&&(a=f)}else if(u>0){if(f<a)return;f<l&&(l=f)}return a>0&&(n[0]=h+a*s,n[1]=d+a*u),l<1&&(t[0]=h+l*s,t[1]=d+l*u),!0}}}}}var rn=1e9,hn=-rn;function ee(n,t,i,e){function o(g,a){return n<=g&&g<=i&&t<=a&&a<=e}function p(g,a,l,s){var u=0,f=0;if(g==null||(u=h(g,l))!==(f=h(a,l))||S(g,a)<0^l>0)do s.point(u===0||u===3?n:i,u>1?e:t);while((u=(u+l+4)%4)!==f);else s.point(a[0],a[1])}function h(g,a){return T(g[0]-n)<I?a>0?0:3:T(g[0]-i)<I?a>0?2:1:T(g[1]-t)<I?a>0?1:0:a>0?3:2}function d(g,a){return S(g.x,a.x)}function S(g,a){var l=h(g,1),s=h(a,1);return l!==s?l-s:l===0?a[1]-g[1]:l===1?g[0]-a[0]:l===2?g[1]-a[1]:a[0]-g[0]}return function(g){var a=g,l=ct(),s,u,f,c,r,x,y,w,m,E,M,_={point:z,lineStart:F,lineEnd:A,polygonStart:O,polygonEnd:C};function z(v,W){o(v,W)&&a.point(v,W)}function P(){for(var v=0,W=0,H=u.length;W<H;++W)for(var $=u[W],q=1,tn=$.length,V=$[0],Z,Q,un=V[0],K=V[1];q<tn;++q)Z=un,Q=K,V=$[q],un=V[0],K=V[1],Q<=e?K>e&&(un-Z)*(e-Q)>(K-Q)*(n-Z)&&++v:K<=e&&(un-Z)*(e-Q)<(K-Q)*(n-Z)&&--v;return v}function O(){a=l,s=[],u=[],M=!0}function C(){var v=P(),W=M&&v,H=(s=at(s)).length;(W||H)&&(g.polygonStart(),W&&(g.lineStart(),p(null,null,1,g),g.lineEnd()),H&&pt(s,d,v,p,g),g.polygonEnd()),a=g,s=u=f=null}function F(){_.point=R,u&&u.push(f=[]),E=!0,m=!1,y=w=NaN}function A(){s&&(R(c,r),x&&m&&l.rejoin(),s.push(l.result())),_.point=z,m&&a.lineEnd()}function R(v,W){var H=o(v,W);if(u&&f.push([v,W]),E)c=v,r=W,x=H,E=!1,H&&(a.lineStart(),a.point(v,W));else if(H&&m)a.point(v,W);else{var $=[y=Math.max(hn,Math.min(rn,y)),w=Math.max(hn,Math.min(rn,w))],q=[v=Math.max(hn,Math.min(rn,v)),W=Math.max(hn,Math.min(rn,W))];te($,q,n,t,i,e)?(m||(a.lineStart(),a.point($[0],$[1])),a.point(q[0],q[1]),H||a.lineEnd(),M=!1):H&&(a.lineStart(),a.point(v,W),M=!1)}y=v,w=W,m=H}return _}}const tt=n=>n;var nn=1/0,mn=nn,an=-nn,yn=an,ie={point:re,lineStart:en,lineEnd:en,polygonStart:en,polygonEnd:en,result:function(){var n=[[nn,mn],[an,yn]];return an=yn=-(mn=nn=1/0),n}};function re(n,t){n<nn&&(nn=n),n>an&&(an=n),t<mn&&(mn=t),t>yn&&(yn=t)}const et=ie;function In(n){return function(t){var i=new Ln;for(var e in n)i[e]=n[e];return i.stream=t,i}}function Ln(){}Ln.prototype={constructor:Ln,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function An(n,t,i){var e=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),e!=null&&n.clipExtent(null),Yt(i,n.stream(et)),t(et.result()),e!=null&&n.clipExtent(e),n}function dt(n,t,i){return An(n,function(e){var o=t[1][0]-t[0][0],p=t[1][1]-t[0][1],h=Math.min(o/(e[1][0]-e[0][0]),p/(e[1][1]-e[0][1])),d=+t[0][0]+(o-h*(e[1][0]+e[0][0]))/2,S=+t[0][1]+(p-h*(e[1][1]+e[0][1]))/2;n.scale(150*h).translate([d,S])},i)}function oe(n,t,i){return dt(n,[[0,0],t],i)}function le(n,t,i){return An(n,function(e){var o=+t,p=o/(e[1][0]-e[0][0]),h=(o-p*(e[1][0]+e[0][0]))/2,d=-p*e[0][1];n.scale(150*p).translate([h,d])},i)}function se(n,t,i){return An(n,function(e){var o=+t,p=o/(e[1][1]-e[0][1]),h=-p*e[0][0],d=(o-p*(e[1][1]+e[0][1]))/2;n.scale(150*p).translate([h,d])},i)}var it=16,ae=N(30*B);function rt(n,t){return+t?fe(n,t):ue(n)}function ue(n){return In({point:function(t,i){t=n(t,i),this.stream.point(t[0],t[1])}})}function fe(n,t){function i(e,o,p,h,d,S,g,a,l,s,u,f,c,r){var x=g-e,y=a-o,w=x*x+y*y;if(w>4*t&&c--){var m=h+s,E=d+u,M=S+f,_=Sn(m*m+E*E+M*M),z=sn(M/=_),P=T(T(M)-1)<I||T(p-l)<I?(p+l)/2:ln(E,m),O=n(P,z),C=O[0],F=O[1],A=C-e,R=F-o,v=y*A-x*R;(v*v/w>t||T((x*A+y*R)/w-.5)>.3||h*s+d*u+S*f<ae)&&(i(e,o,p,h,d,S,C,F,P,m/=_,E/=_,M,c,r),r.point(C,F),i(C,F,P,m,E,M,g,a,l,s,u,f,c,r))}}return function(e){var o,p,h,d,S,g,a,l,s,u,f,c,r={point:x,lineStart:y,lineEnd:m,polygonStart:function(){e.polygonStart(),r.lineStart=E},polygonEnd:function(){e.polygonEnd(),r.lineStart=y}};function x(z,P){z=n(z,P),e.point(z[0],z[1])}function y(){l=NaN,r.point=w,e.lineStart()}function w(z,P){var O=b([z,P]),C=n(z,P);i(l,s,a,u,f,c,l=C[0],s=C[1],a=z,u=O[0],f=O[1],c=O[2],it,e),e.point(l,s)}function m(){r.point=x,e.lineEnd()}function E(){y(),r.point=M,r.lineEnd=_}function M(z,P){w(o=z,P),p=l,h=s,d=u,S=f,g=c,r.point=w}function _(){i(l,s,a,u,f,c,p,h,o,d,S,g,it,e),r.lineEnd=m,m()}return r}}var ce=In({point:function(n,t){this.stream.point(n*B,t*B)}});function pe(n){return In({point:function(t,i){var e=n(t,i);return this.stream.point(e[0],e[1])}})}function he(n,t,i,e,o){function p(h,d){return h*=e,d*=o,[t+n*h,i-n*d]}return p.invert=function(h,d){return[(h-t)/n*e,(i-d)/n*o]},p}function ot(n,t,i,e,o,p){if(!p)return he(n,t,i,e,o);var h=N(p),d=D(p),S=h*n,g=d*n,a=h/n,l=d/n,s=(d*i-h*t)/n,u=(d*t+h*i)/n;function f(c,r){return c*=e,r*=o,[S*c-g*r+t,i-g*c-S*r]}return f.invert=function(c,r){return[e*(a*c-l*r+s),o*(u-l*c-a*r)]},f}function de(n){return ve(function(){return n})()}function ve(n){var t,i=150,e=480,o=250,p=0,h=0,d=0,S=0,g=0,a,l=0,s=1,u=1,f=null,c=nt,r=null,x,y,w,m=tt,E=.5,M,_,z,P,O;function C(v){return z(v[0]*B,v[1]*B)}function F(v){return v=z.invert(v[0],v[1]),v&&[v[0]*U,v[1]*U]}C.stream=function(v){return P&&O===v?P:P=ce(pe(a)(c(M(m(O=v)))))},C.preclip=function(v){return arguments.length?(c=v,f=void 0,R()):c},C.postclip=function(v){return arguments.length?(m=v,r=x=y=w=null,R()):m},C.clipAngle=function(v){return arguments.length?(c=+v?ne(f=v*B):(f=null,nt),R()):f*U},C.clipExtent=function(v){return arguments.length?(m=v==null?(r=x=y=w=null,tt):ee(r=+v[0][0],x=+v[0][1],y=+v[1][0],w=+v[1][1]),R()):r==null?null:[[r,x],[y,w]]},C.scale=function(v){return arguments.length?(i=+v,A()):i},C.translate=function(v){return arguments.length?(e=+v[0],o=+v[1],A()):[e,o]},C.center=function(v){return arguments.length?(p=v[0]%360*B,h=v[1]%360*B,A()):[p*U,h*U]},C.rotate=function(v){return arguments.length?(d=v[0]%360*B,S=v[1]%360*B,g=v.length>2?v[2]%360*B:0,A()):[d*U,S*U,g*U]},C.angle=function(v){return arguments.length?(l=v%360*B,A()):l*U},C.reflectX=function(v){return arguments.length?(s=v?-1:1,A()):s<0},C.reflectY=function(v){return arguments.length?(u=v?-1:1,A()):u<0},C.precision=function(v){return arguments.length?(M=rt(_,E=v*v),R()):Sn(E)},C.fitExtent=function(v,W){return dt(C,v,W)},C.fitSize=function(v,W){return oe(C,v,W)},C.fitWidth=function(v,W){return le(C,v,W)},C.fitHeight=function(v,W){return se(C,v,W)};function A(){var v=ot(i,0,0,s,u,l).apply(null,t(p,h)),W=ot(i,e-v[0],o-v[1],s,u,l);return a=ft(d,S,g),_=zn(t,W),z=zn(a,_),M=rt(_,E),R()}function R(){return P=O=null,C}return function(){return t=n.apply(this,arguments),C.invert=t.invert&&F,A()}}function Tn(n,t){return[n,Gt(qt((G+t)/2))]}Tn.invert=function(n,t){return[n,2*ut($t(t))-G]};function ge(){return me(Tn).scale(961/X)}function me(n){var t=de(n),i=t.center,e=t.scale,o=t.translate,p=t.clipExtent,h=null,d,S,g;t.scale=function(l){return arguments.length?(e(l),a()):e()},t.translate=function(l){return arguments.length?(o(l),a()):o()},t.center=function(l){return arguments.length?(i(l),a()):i()},t.clipExtent=function(l){return arguments.length?(l==null?h=d=S=g=null:(h=+l[0][0],d=+l[0][1],S=+l[1][0],g=+l[1][1]),a()):h==null?null:[[h,d],[S,g]]};function a(){var l=L*e(),s=t(Vt(t.rotate()).invert([0,0]));return p(h==null?[[s[0]-l,s[1]-l],[s[0]+l,s[1]+l]]:n===Tn?[[Math.max(s[0]-l,h),d],[Math.min(s[0]+l,S),g]]:[[h,Math.max(s[1]-l,d)],[S,Math.min(s[1]+l,g)]])}return a()}function on(n,t,i){this.k=n,this.x=t,this.y=i}on.prototype={constructor:on,scale:function(n){return n===1?this:new on(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new on(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};on.prototype;function ye(){const t="#8ECBFF",i=new mt(1,1,1,1),e=`  
    varying vec2 vUv;
    void main() { 
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
    }`,o=`
    varying vec2 vUv;
    uniform vec3 uColor;
    uniform float uOpacity;
    uniform float uSpeed; 
    uniform float uSge;
    uniform float time;
    float PI = 3.14159265;
    float drawCircle(float index, float range) {
        float opacity = 1.0;
        if (index >= 1.0 - range) {
            opacity = 1.0 - (index - (1.0 - range)) / range;
        } else if(index <= range) {
            opacity = index / range;
        } 
        return opacity;
    }
    float distanceTo(vec2 src, vec2 dst) {
        float dx = src.x - dst.x;
        float dy = src.y - dst.y;
        float dv = dx * dx + dy * dy;
        return sqrt(dv);
    } 
    void main() { 
        float iTime = -time * uSpeed;
        float opacity = 0.0;
        float len = distanceTo(vec2(0.5, 0.5), vec2(vUv.x, vUv.y)); 

        float size = 1.0 / uSge;
        vec2 range = vec2(0.7 - size, 0.7 + size);
        float index = mod(iTime + len, size); 
        // 中心圆 
        vec2 cRadius = vec2(0.06, 0.12); 
        
        if (index < size && len <= 0.5) {   
            float i = sin(index / size * PI); 

            // 处理边缘锯齿
            if (i >= range.x && i <= range.y){
                // 归一
                float t = (i - range.x) / (range.y - range.x);
                // 边缘锯齿范围
                float r = 0.3;
                opacity = drawCircle(t, r);
                
            }
            // 渐变
            opacity *=  1.0 - len / 0.5;
        }; 
        
        gl_FragColor = vec4(uColor, uOpacity * opacity);
    }`,p=new lt({uniforms:{uColor:{value:new On(t)},uOpacity:{value:1},uSpeed:{value:.2},uSge:{value:2},uRadius:{value:1/2},time:{value:0}},transparent:!0,vertexShader:e,fragmentShader:o,alphaTest:.5,side:st,depthWrite:!1});return new Rn(i,p)}function we(){let t=new On(9358335);const i=new lt({vertexShader:`
            varying vec3 modelPos;
            void main() {
                modelPos = position;
                // 顶点位置计算，这里简化为直接输出
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 lightColor;
            uniform float intensity;
            uniform float height;
            varying vec3 modelPos;

            void main() {
                // 计算光线效果
                gl_FragColor = vec4(lightColor, 1);
            }
        `,uniforms:{lightColor:{value:new k(t.r,t.g,t.b)},intensity:{value:1},height:{value:.5}}}),e=new yt(.1,.01,.5,10,10,!1);return new Rn(e,i)}function Se(){const n=["A","B","C","M","E","U"],t=n[Math.floor(Math.random()*n.length)],i=["","D","F"],e=i[Math.floor(Math.random()*i.length)];for(var o="ABCDEFGHJKLMNPQRSTUVWXYZ1234567890",p="",h=0;h<5;h++)p+=o.charAt(Math.floor(Math.random()*o.length));var d="苏"+t+e+p;return d}const xe={id:"map"},Pe={__name:"index",setup(n){Ot(()=>{const s=new wt,u=new St(13953021,4);s.add(u);const f=new xt(15264491,.2);f.position.set(0,10,5);const c=f.clone();c.position.set(0,10,-5);const r=f.clone();r.position.set(5,10,0);const x=f.clone();x.position.set(-5,10,0),s.add(f),s.add(c),s.add(r),s.add(x);const y=new Et(75,window.innerWidth/window.innerHeight,.1,1e3);y.position.y=3,y.position.z=3;const w=new At;w.domElement.style.position="absolute",w.domElement.style.top="0px",w.domElement.style.pointerEvents="none",w.setSize(window.innerWidth,window.innerHeight),document.getElementById("map").appendChild(w.domElement);const m=new Dt;m.domElement.style.position="absolute",m.domElement.style.top="0px",m.domElement.style.pointerEvents="none",m.setSize(window.innerWidth,window.innerHeight),document.getElementById("map").appendChild(m.domElement);const E=new Mt({antialias:!0});E.setSize(window.innerWidth,window.innerHeight),E.setPixelRatio(window.devicePixelRatio),E.autoClear=!1,document.getElementById("map").appendChild(E.domElement);const M=new Ct(y,E.domElement);M.update();const _=()=>{requestAnimationFrame(_),M.update(),E.render(s,y),w.render(s,y),m.render(s,y),d.children.forEach(P=>{P.material.uniforms.time.value+=.02}),J.update()};_(),window.addEventListener("resize",()=>{y.aspect=window.innerWidth/window.innerHeight,y.updateProjectionMatrix(),E.setSize(window.innerWidth,window.innerHeight),w.setSize(window.innerWidth,window.innerHeight)}),fetch("/wj.json").then(P=>P.json()).then(P=>{const O=e(P);s.add(O),g(O),window.addEventListener("pointerdown",C=>{})})});const t=ge().scale(500),i=new Mn,e=s=>{const u=s.features[0].properties.centroid;return t.center(u).translate([0,0]),s.features.forEach(f=>{const c=new Mn,{centroid:r,center:x,name:y}=f.properties,{coordinates:w,type:m}=f.geometry,E=r||x||[0,0],M=new On(`hsl(
        233,
        ${Math.random()*30+55}%,
        ${Math.random()*30+55}%)`).getHex(),_=.2,z=h(y,E,_);w.forEach(P=>{m==="MultiPolygon"&&P.forEach(C=>O(C)),m==="Polygon"&&O(P);function O(C){c.name=y;const F=o(C,M,_),A=p(C,_);c.add(F,...A)}}),i.add(c,z),l(i)}),i},o=(s,u,f)=>{const c=new Pt;s.forEach((E,M)=>{const[_,z]=t(E);M===0?c.moveTo(_,-z):c.lineTo(_,-z)});const r={depth:f,bevelEnabled:!1},x={color:u,emissive:0,roughness:.45,metalness:.8,transparent:!0,side:st},y=new _t(c,r),w=new zt(x);return new Rn(y,w)},p=(s,u)=>{const f=[];s.forEach(m=>{const[E,M]=t(m);f.push(new k(E,-M,0))});const c=new Wt().setFromPoints(f),r=new Nn({color:16777215}),x=new Nn({color:16777215}),y=new Dn(c,r),w=new Dn(c,x);return w.position.z=-1e-4,y.position.z=u+1e-4,[y,w]},h=(s,u,f)=>{const c=document.createElement("div");c.style.color="#fff",c.style.fontSize="12px",c.style.textShadow="1px 1px 2px #047cd6",c.textContent=s;const r=new Hn(c);r.scale.set(.01,.01,.01);const[x,y]=t(u);return r.position.set(x,-y,f),r},d=new Bn,S=new Bn,g=s=>{fetch("./park2.json").then(u=>u.json()).then(u=>{const f=[],c=new k;u.forEach(r=>{const[x,y]=t([r.longitude,r.latitude]);c.x=x,c.y=-y,c.z=.5,f.push(c.x,c.y,c.z);const w=ye();w.position.set(x,-y,.3),w.scale.setScalar(.2),d.add(w);const m=we();m.position.set(x,-y,.3),m.scale.setScalar(.3),m.rotation.x=Math.PI/2,S.add(m),new J.Tween(m.position).to({z:.33},1e3).easing(J.Easing.Quadratic.InOut).yoyo(!0).repeat(1/0).delay(Math.random()*1e3).start()}),s.add(d),s.add(S),setInterval(()=>{i.add(a(u))},2e3)})},a=s=>{const u=Se(),f=s[Math.floor(Math.random()*s.length)],[c,r]=t([f.longitude,f.latitude]),x=["入场","出场"],y=document.createElement("div");y.style.color="#fff",y.style.fontSize="12px",y.style.borderRadius="4px",y.style.padding="3px 6px",y.style.opacity=0,y.innerHTML=`
      <div class="info-box">
        <p>车场：${f.parkName}</p>
        <p>车辆：<span style="color: ${u.length===7?"blue":"green"}">${u}</span></p>
        <p>行为：${x[Math.floor(Math.random()*x.length)]}</p>
      </div>
    `;let w=new Hn(y);return w.scale.set(.01,.01,.01),w.position.set(c,-r,.6),new J.Tween({opacity:0}).to({opacity:1},1e3).easing(J.Easing.Quadratic.Out).onUpdate(m=>{w.element.style.opacity=m.opacity}).onComplete(()=>{new J.Tween({opacity:1}).to({opacity:0},1e3).easing(J.Easing.Quadratic.Out).delay(3e3).onUpdate(m=>{w.element.style.opacity=m.opacity}).onComplete(()=>{var m=w.element.parentElement;m&&m.removeChild(w.element),i.remove(w),w=null}).start()}).start(),w},l=s=>{s.rotation.x=-Math.PI/2;const f=new Lt().setFromObject(s).getCenter(new k),c=[0,0];s.position.x=s.position.x-f.x-c[0],s.position.z=s.position.z-f.z-c[1]};return(s,u)=>(Rt(),It("div",xe))}};export{Pe as default};
